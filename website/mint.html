<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Mint your unique MATTERN42 NFT on Ethereum - Professional NFT minting platform with IPFS and on-chain storage options">
    <meta name="keywords" content="NFT, Ethereum, Mint, MATTERN42, Blockchain, IPFS">
    <meta name="author" content="MATTERN42">
    <title>MATTERN42 NFT - Professional Minting Platform</title>
    
    <!-- Preload critical resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Ethers.js -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.7.1/dist/ethers.umd.min.js"></script>
    
    <!-- Styles -->
    <link rel="stylesheet" href="style.css">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ¦¡</text></svg>">
</head>
<body>
    <main class="container" role="main">
        <header>
            <h1>
                <span role="img" aria-label="Badger">ðŸ¦¡</span>
                MATTERN42 NFT
            </h1>
        </header>
        
        <!-- Statistics Dashboard -->
        <section class="stats" aria-label="NFT Statistics">
            <div class="stat">
                <div class="stat-number" id="totalSupply" aria-live="polite">-</div>
                <div>Total Supply</div>
            </div>
            <div class="stat">
                <div class="stat-number" id="userBalance" aria-live="polite">-</div>
                <div>Your Collection</div>
            </div>
            <div class="stat" id="contractInfo" style="display: none;">
                <div id="contractDisplay" role="text" aria-label="Contract Address"></div>
                <div>Smart Contract</div>
                <button 
                    onclick="app.resetContract()" 
                    aria-label="Change contract address"
                    title="Change contract address"
                >
                    Change Contract
                </button>
            </div>
        </section>

        <!-- Wallet Connection -->
        <section id="connectSection" aria-label="Wallet Connection">
            <button 
                class="mint-btn" 
                onclick="app.connectWallet()"
                aria-label="Connect your Ethereum wallet"
            >
                Connect Wallet
            </button>
            <p style="color: var(--text-secondary); font-size: 0.875rem; margin-top: 1rem;">
                Connect your MetaMask or compatible Ethereum wallet to start minting
            </p>
        </section>

        <!-- Minting Interface -->
        <section id="mintSection" class="hidden" aria-label="NFT Minting">
            <div class="mint-section">
                <!-- Storage Mode Selection -->
                <div class="mode-selection" role="radiogroup" aria-label="Choose storage method">
                    <button 
                        class="mode-btn active" 
                        onclick="app.setMode('ipfs')"
                        role="radio"
                        aria-checked="true"
                        aria-label="IPFS storage mode"
                    >
                        IPFS Storage
                        <small style="display: block; font-size: 0.75rem; opacity: 0.8;">~0.0002 ETH</small>
                    </button>
                    <button 
                        class="mode-btn" 
                        onclick="app.setMode('onchain')"
                        role="radio"
                        aria-checked="false"
                        aria-label="On-chain storage mode"
                    >
                        On-Chain Storage
                        <small style="display: block; font-size: 0.75rem; opacity: 0.8;">~0.3 ETH</small>
                    </button>
                </div>
                </div>
                
                                <!-- Mode Information -->
                <div class="mode-info">
                    <div id="modeInfo">
                        <strong>IPFS Mode:</strong> Metadata with IPFS image reference - Lower cost, traditional approach
                    </div>
                </div>
                
                <!-- Collection Info -->
                <div style="
                    margin: 1.5rem 0;
                    padding: 1.25rem;
                    background: rgba(16, 185, 129, 0.05);
                    border: 1px solid rgba(16, 185, 129, 0.2);
                    border-radius: var(--border-radius);
                    text-align: left;
                ">
                    <h3 style="
                        color: var(--success);
                        margin: 0 0 0.75rem 0;
                        font-size: 1rem;
                        font-weight: 600;
                    ">
                        <span role="img" aria-hidden="true">ðŸ¦¡</span>
                        BADGER42 Collection
                    </h3>
                    <p style="
                        color: var(--text-secondary);
                        margin: 0;
                        font-size: 0.9rem;
                        line-height: 1.5;
                    ">
                        Each NFT features the unique BADGER42 artwork with automatic naming and numbering. 
                        Your NFT will be named based on the collection standard.
                    </p>
                </div>
                
                <!-- Minting Actions -->
                <div class="mint-actions">
                    <button 
                        class="mint-btn" 
                        onclick="app.mint()" 
                        id="mintBtn"
                        aria-label="Mint your NFT"
                    >
                        Mint NFT
                    </button>
                </div>
            </div>
        </section>

        <!-- Transaction Status -->
        <section id="status" class="status-section" role="status" aria-live="polite"></section>

        <!-- NFT Gallery -->
        <section id="gallery" class="nft-gallery" aria-label="Your NFT Collection"></section>
    </main>

    <!-- Scripts -->
    <script type="module">
        // Import modules
        import { CONFIG, loadConfig } from './config.js';
        import { CONTRACT_ABI } from './contract-abi.js';
        import { IPFSUtils, MetadataUtils, UIUtils } from './utils.js';
        import { NFTApp } from './app.js';
        
        // Make available globally for onclick handlers
        window.CONFIG = CONFIG;
        window.CONTRACT_ABI = CONTRACT_ABI;
        window.IPFSUtils = IPFSUtils;
        window.MetadataUtils = MetadataUtils;
        window.UIUtils = UIUtils;
        window.NFTApp = NFTApp;
        
        // Initialize the app with proper error handling
        let app;
        
        // Initialize when page loads
        window.addEventListener('load', async () => {
            try {
                // Load configuration from server first
                await loadConfig();
                
                // Then initialize the app
                app = new NFTApp();
                window.app = app; // Make available for onclick handlers
                await app.init();
                
                console.log('MATTERN42 NFT App initialized successfully');
            } catch (error) {
                console.error('Failed to initialize app:', error);
                const statusElement = document.getElementById('status');
                if (statusElement) {
                    statusElement.innerHTML = 
                        '<div class="status error">Failed to initialize application. Please refresh the page.</div>';
                    statusElement.style.display = 'block';
                }
            }
        });
    </script>
</body>
</html>
